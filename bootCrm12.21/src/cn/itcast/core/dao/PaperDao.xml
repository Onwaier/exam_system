<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.itcast.core.dao.PaperDao">

   <sql id="selectPaperListWhere">
 		<where>
		   <if test="courseId != null" >
	        and courseId = #{courseId}
	      </if>
	      <if test="difficulty != null" >
	        and difficulty = #{difficulty}
	      </if>
	       <if test="type != null" >
	        and type = #{type}
	      </if>
	       <if test="chapter != null" >
	        and chapter = #{chapter}
	      </if>	
	       <if test="knowPoint != null" >
	        and knowPoint = #{knowPoint}
	      </if> 

    	</where>
	</sql>
	
	
	
	
	<select id="selectPaperList" parameterType="paper" resultType="paper">
		SELECT 
			id,
			title,
			joinTime,
			questionSet,
			userId,
			userName,
			scoreAve,
			typeNum,
			typeScore,
			courseName
		FROM
			paper, course
		WHERE paper.courseId = course.courseId	 
    		
    	<if test="courseId != null" >
	        and paper.courseId = #{courseId}
	     </if>
		<if test="start !=null and rows != null">
			limit #{start},#{rows}
		</if>
	</select>
	
	<select id="selectPaper" parameterType="paper" resultType="paper">
		SELECT 
			id,
			title,
			joinTime,
			questionSet,
			userId,
			scoreAve,
			typeNum,
			typeScore,
			courseName
		FROM
			paper, course
		WHERE paper.courseId = course.courseId	 
    		
 		<if test="courseId != null" >
	        and paper.courseId = #{courseId}
	     </if>
	</select>
	
	<select id="selectPaperListCount" parameterType="paper" resultType="int">
		select count(*)
		from paper
	</select>
	
	<!-- 通过科目id查询章节 -->
	<select  id="selectChapterList" resultType="java.lang.String">
		select distinct chapter
		from knowledgepoint
		where courseId = #{courseId}
	</select>
	
	<!-- 通过科目id和章节查询知识点 -->
	<select  id="selectKnowpointList" resultType="java.lang.String">
		select distinct knowPoint
		from knowledgepoint
		where courseId = #{param1} and chapter = #{param2}
	</select>
	
<!-- 	查询题目列表 -->
	<select id="selectQuestionList" parameterType="question" resultType="question">
		SELECT *
		FROM
			question
			
      <include refid="selectPaperListWhere"/>
	</select>
	
<!-- 	查询题目总数 -->
	<select id="selectQuestionListCount" parameterType="question" resultType="int">
		select count(*)
		from question
		<include refid="selectPaperListWhere"/>
	</select>
	
	<!-- 	查询科目列表 -->
	<select id="selectCourseList" parameterType="course" resultType="course">
		SELECT *
		FROM
			course 
		ORDER BY courseName ASC
	</select>
	
<!-- 	保存试卷到数据库 -->
	<insert id="savePaper" parameterType="paper" 
        useGeneratedKeys="true" keyProperty="id"> 
        insert into paper(id, title, courseId, questionSet, joinTime, userId, userName)  
             values(#{id},#{title},#{courseId},#{questionSet},#{joinTime}, #{userId}, #{userName})  
    </insert>
    
    <!-- 删除试卷 -->
	<delete id="deletePaper" parameterType="long">
		delete from paper where id=#{id}
	</delete>
	
	<!-- 根据id查询题目 -->
	<select id="selectQuestionListById" resultType="question">
		select *
        from question
        where qid = #{qid}

	</select>
	
</mapper>